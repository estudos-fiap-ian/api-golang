apiVersion: v1
kind: Service
metadata:
  name: go-web-api-service-nlb
  annotations:
    # Annotations for NLB optimization
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
    # Health check configuration
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-path: "/ping"
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-protocol: "HTTP"
    service.beta.kubernetes.io/aws-load-balancer-healthcheck-port: "8080"
    # NLB performance
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"
spec:
  type: NodePort
  selector:
    app: go-web-api
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 30080  # Fixed NodePort for NLB target group
  sessionAffinity: None